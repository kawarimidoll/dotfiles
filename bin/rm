#!/usr/bin/env bash

# 事前に許可したファイルしかrmしないようにする
# https://zenn.dev/kawarimidoll/articles/70e473a198badf

rm_abort() {
  echo "'rm' is dangerous command! Use 'trash' instead"
  exit 1
}

# 安全に削除できるファイル名を連想配列で定義
declare -A safe_files=(
  [".DS_Store"]=1
  ["node_modules"]=1
  ["_gen"]=1
)

# オプション以外の引数を抽出
args=()
for arg in "$@"; do
  [[ "$arg" != -* ]] && args+=("$arg")
done

# 引数があるか確認
if [[ ${#args[@]} -eq 0 ]]; then
  rm_abort
fi

# 全ての引数が安全か判定
for arg in "${args[@]}"; do
  base=$(basename "$arg")
  if [[ -z "${safe_files[$base]}" ]]; then
    rm_abort
  fi
done

# 実行
/Users/kawarimidoll/.nix-profile/bin/rm -i --preserve-root "$@"
